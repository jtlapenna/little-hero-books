<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page 01 - Twilight Walk</title>
    <style>
        @page {
            size: 8.5in 8.5in;
            margin: 0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @font-face {
            font-family: 'CustomFont';
            src: url('../renderer-mock/assets/fonts/custom-font.ttf') format('truetype');
        }
        
    body {
        font-family: 'CustomFont', 'Arial', sans-serif;
        width: 8.5in;
        height: 8.5in;
        position: relative;
        overflow: hidden;
        background-color: #000;
    }
        
        .page {
            width: 8.5in;
            height: 8.5in;
            position: relative;
            background-image: url('../assets/images/page01-twilight-walk.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: none;
            box-shadow: none;
        }
        
        /* LOCKED-IN TEXT BOX SPECIFICATIONS */
        .text-box {
            position: absolute;
            left: 50%;
            bottom: 3%;
            width: 80%; /* Increased to 80% for better text fit */
            transform: translateX(-50%);
            height: auto;
            background-image: url('../renderer-mock/assets/overlays/text-boxes/standard-box.png');
            background-size: 100% 100%; /* Stretch to fit content */
            background-repeat: no-repeat;
            background-position: center;
            padding: 25px 60px; /* More horizontal padding for wider box */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* LOCKED-IN TEXT SPECIFICATIONS */
        .text-content {
            font-size: 14px;
            line-height: 1.3; /* Slightly increased for better readability */
            letter-spacing: 0.5px;
            color: #312116;
            text-align: center;
            font-weight: 400;
            width: 100%;
            word-wrap: break-word;
            hyphens: none; /* Prevent hyphenation */
        }
        
        /* CHARACTER POSITIONING - ADJUST THESE VALUES */
        .character {
            position: absolute;
            right: 5%;
            top: 15%;
            width: 300px;
            height: auto;
            z-index: 100;
            border: 2px dashed red; /* Debug border - remove when positioning is correct */
        }
        
    .character img {
        width: 100%;
        height: auto;
    }
    
    /* CHARACTER LIGHTING FILTERS - CUSTOM GRADIENT SYSTEM */
    .character-lighting {
        position: relative;
        display: inline-block;
        width: 100%;
        height: 100%;
    }

    /* Hide the original img - we'll display it via ::before */
    .character-lighting img {
        display: block;
        width: 100%;
        height: auto;
        opacity: 0;
        position: relative;
        z-index: 0;
    }

    /* Create a pseudo-element with layered backgrounds (gradient + character) that blends */
    .character-lighting::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: 1;
        /* Layer gradient over character image */
        background-image:
            linear-gradient(to bottom, rgba(255, 107, 53, 0.5) 0%, rgba(78, 205, 196, 0.5) 100%),
            url('../assets/poses/new-story/walking.png');
        background-size: 100% 100%, contain;
        background-position: center, center;
        background-repeat: no-repeat, no-repeat;
        background-blend-mode: overlay;
        /* Mask the entire thing to only show where character has pixels */
        -webkit-mask-image: url('../assets/poses/new-story/walking.png');
        -webkit-mask-size: contain;
        -webkit-mask-repeat: no-repeat;
        -webkit-mask-position: center;
        mask-image: url('../assets/poses/new-story/walking.png');
        mask-size: contain;
        mask-repeat: no-repeat;
        mask-position: center;
    }
        
        .position-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            font-family: monospace;
            max-width: 350px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .position-controls.collapsed {
            max-width: 50px;
            max-height: 50px;
            padding: 10px;
            overflow: hidden;
            cursor: pointer;
        }
        
        .position-controls.collapsed .controls-content {
            display: none;
        }
        
        .position-controls .collapse-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .position-controls .collapse-btn:hover {
            background: #5568d3;
        }
        
        .position-controls.collapsed .collapse-btn {
            position: static;
            width: 30px;
            height: 30px;
            font-size: 20px;
        }
        
        .position-controls h4 {
            margin-bottom: 8px;
            color: #333;
        }
        
        .position-controls input {
            width: 60px;
            margin: 2px;
        }
        
        @media print {
            .position-controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="position-controls" id="controls">
        <button class="collapse-btn" onclick="toggleControls()" title="Collapse/Expand">âˆ’</button>
        <div class="controls-content">
        <h4>ðŸŽ¯ Character Position</h4>
        <div>
            <label>Right: <input type="number" id="right" value="5" onchange="updatePosition()">%</label>
        </div>
        <div>
            <label>Top: <input type="number" id="top" value="15" onchange="updatePosition()">%</label>
        </div>
        <div>
            <label>Width: <input type="number" id="width" value="300" onchange="updatePosition()">px</label>
        </div>
        <div style="margin-top: 10px;">
            <label><input type="checkbox" id="flipHorizontal" onchange="updatePosition()"> Flip Horizontal</label>
        </div>
        <div style="margin-top: 10px;">
            <label>Rotation: <input type="number" id="rotation" value="0" step="1" onchange="updatePosition()">Â°</label>
        </div>
        <div style="margin-top: 10px;">
            <h4>ðŸŒ… Custom Lighting Gradient</h4>
            
            <div style="margin-bottom: 10px;">
                <label>Gradient Direction:</label>
                <select id="gradientDirection" onchange="updateLighting()">
                    <option value="to bottom">Top to Bottom</option>
                    <option value="to right">Left to Right</option>
                    <option value="to bottom right">Top-Left to Bottom-Right</option>
                    <option value="to bottom left">Top-Right to Bottom-Left</option>
                    <option value="radial">Radial (Center)</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 15px; margin-bottom: 10px;">
                <div style="flex: 1;">
                    <h5>Start Color (Top/Left)</h5>
                    <div>
                        <label>Color: <input type="color" id="startColor" value="#ff6b35" onchange="updateLighting()"></label>
                    </div>
                    <div>
                        <label>Opacity: <input type="range" id="startOpacity" min="0" max="100" value="50" onchange="updateLighting()"> <span id="startOpacityValue">50%</span></label>
                    </div>
                </div>
                
                <div style="flex: 1;">
                    <h5>End Color (Bottom/Right)</h5>
                    <div>
                        <label>Color: <input type="color" id="endColor" value="#4ecdc4" onchange="updateLighting()"></label>
                    </div>
                    <div>
                        <label>Opacity: <input type="range" id="endOpacity" min="0" max="100" value="50" onchange="updateLighting()"> <span id="endOpacityValue">50%</span></label>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label>Blend Mode:</label>
                <select id="blendMode" onchange="updateLighting()">
                    <option value="normal">Normal</option>
                    <option value="none">None (Disabled)</option>
                    <option value="overlay" selected>Overlay</option>
                    <option value="multiply">Multiply</option>
                    <option value="screen">Screen</option>
                    <option value="soft-light">Soft Light</option>
                    <option value="hard-light">Hard Light</option>
                    <option value="color-dodge">Color Dodge</option>
                    <option value="color-burn">Color Burn</option>
                    <option value="difference">Difference</option>
                </select>
            </div>
            
            <div style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                <strong>Preview:</strong>
                <div id="gradientPreview" style="width: 100%; height: 30px; border: 1px solid #ccc; margin-top: 5px;"></div>
            </div>
        </div>
        <div style="margin-top: 10px;">
            <button onclick="copyPosition()">Copy CSS</button>
        </div>
        </div>
    </div>
    
    <div class="page">
        <div class="text-box">
            <div class="text-content">
                It was a nice evening in Seattle. Alex went for a walk. A soft voice whispered, "You are very brave."
            </div>
        </div>
        
          <div class="character character-lighting" id="character">
              <img src="../assets/poses/new-story/walking.png" alt="Character">
          </div>
    </div>
    
    <script>
        // Toggle controls collapse/expand
        function toggleControls() {
            const controls = document.getElementById('controls');
            const btn = controls.querySelector('.collapse-btn');
            controls.classList.toggle('collapsed');
            btn.textContent = controls.classList.contains('collapsed') ? '+' : 'âˆ’';
        }
        
        // Initialize lighting on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateLighting();
        });
        
        function updateLighting() {
            const character = document.getElementById('character');
            const characterImg = character.querySelector('img');
            const gradientDirection = document.getElementById('gradientDirection').value;
            const startColor = document.getElementById('startColor').value;
            const endColor = document.getElementById('endColor').value;
            const startOpacity = document.getElementById('startOpacity').value;
            const endOpacity = document.getElementById('endOpacity').value;
            const blendMode = document.getElementById('blendMode').value;

            // Update opacity display values
            document.getElementById('startOpacityValue').textContent = startOpacity + '%';
            document.getElementById('endOpacityValue').textContent = endOpacity + '%';

            // Convert hex colors to rgba with proper opacity
            const startColorRgba = hexToRgba(startColor, startOpacity / 100);
            const endColorRgba = hexToRgba(endColor, endOpacity / 100);

            // Create gradient CSS
            let gradientCss;
            if (gradientDirection === 'radial') {
                gradientCss = `radial-gradient(circle, ${startColorRgba} 0%, ${endColorRgba} 100%)`;
            } else {
                gradientCss = `linear-gradient(${gradientDirection}, ${startColorRgba} 0%, ${endColorRgba} 100%)`;
            }

            // Get character image URL
            const characterImageUrl = characterImg.getAttribute('src');

            // Remove existing dynamic style if any
            let styleEl = document.getElementById('dynamic-lighting-style');
            if (!styleEl) {
                styleEl = document.createElement('style');
                styleEl.id = 'dynamic-lighting-style';
                document.head.appendChild(styleEl);
            }

            // If blend mode is "none", show character without gradient
            if (blendMode === 'none') {
                styleEl.textContent = `
                    #character::before {
                        background-image: url("${characterImageUrl}") !important;
                        background-size: contain !important;
                        background-position: center !important;
                        background-repeat: no-repeat !important;
                        background-blend-mode: normal !important;
                        -webkit-mask-image: none !important;
                        mask-image: none !important;
                    }
                `;
            } else {
                // Create dynamic CSS rule with layered backgrounds + blend mode + mask
                styleEl.textContent = `
                    #character::before {
                        background-image: ${gradientCss}, url("${characterImageUrl}") !important;
                        background-size: 100% 100%, contain !important;
                        background-position: center, center !important;
                        background-repeat: no-repeat, no-repeat !important;
                        background-blend-mode: ${blendMode} !important;
                        -webkit-mask-image: url("${characterImageUrl}") !important;
                        -webkit-mask-size: contain !important;
                        -webkit-mask-repeat: no-repeat !important;
                        -webkit-mask-position: center !important;
                        mask-image: url("${characterImageUrl}") !important;
                        mask-size: contain !important;
                        mask-repeat: no-repeat !important;
                        mask-position: center !important;
                    }
                `;
            }

            // Update preview
            const preview = document.getElementById('gradientPreview');
            preview.style.background = gradientCss;

            console.log(`Applied gradient: ${gradientCss} with blend mode: ${blendMode}`);
            console.log(`Character image: ${characterImageUrl}`);
        }
        
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        function updatePosition() {
            const character = document.getElementById('character');
            const right = document.getElementById('right').value;
            const top = document.getElementById('top').value;
            const width = document.getElementById('width').value;
            const flipHorizontal = document.getElementById('flipHorizontal').checked;
            const rotation = document.getElementById('rotation').value;
            
            character.style.right = right + '%';
            character.style.top = top + '%';
            character.style.width = width + 'px';
            
            // Build transform property with flip and rotation
            const transforms = [];
            transforms.push(flipHorizontal ? 'scaleX(-1)' : 'scaleX(1)');
            if (rotation != 0) {
                transforms.push(`rotateZ(${rotation}deg)`);
            }
            character.style.transform = transforms.join(' ');
        }
        
        function copyPosition() {
            const right = document.getElementById('right').value;
            const top = document.getElementById('top').value;
            const width = document.getElementById('width').value;
            const flipHorizontal = document.getElementById('flipHorizontal').checked;
            const rotation = document.getElementById('rotation').value;
            const gradientDirection = document.getElementById('gradientDirection').value;
            const startColor = document.getElementById('startColor').value;
            const endColor = document.getElementById('endColor').value;
            const startOpacity = document.getElementById('startOpacity').value;
            const endOpacity = document.getElementById('endOpacity').value;
            const blendMode = document.getElementById('blendMode').value;
            
            const startColorRgba = hexToRgba(startColor, startOpacity / 100);
            const endColorRgba = hexToRgba(endColor, endOpacity / 100);
            
            let gradientCss;
            if (gradientDirection === 'radial') {
                gradientCss = `radial-gradient(circle, ${startColorRgba} 0%, ${endColorRgba} 100%)`;
            } else {
                gradientCss = `linear-gradient(${gradientDirection}, ${startColorRgba} 0%, ${endColorRgba} 100%)`;
            }
            
            // Build transform CSS with flip and rotation
            const transforms = [];
            transforms.push(flipHorizontal ? 'scaleX(-1)' : 'scaleX(1)');
            if (rotation != 0) {
                transforms.push(`rotateZ(${rotation}deg)`);
            }
            const transformCss = transforms.join(' ');
            
            const positioningLines = [
                `right: ${right}%;`,
                `top: ${top}%;`,
                `width: ${width}px;`,
                `transform: ${transformCss};`
            ];
            
            const fullCss = `/* Character Positioning */\n.character {\n    position: absolute;\n    ${positioningLines.join(' ')}\n    height: auto;\n    z-index: 100;\n}\n\n/* Character Lighting */\n.character-lighting::before {\n    content: '';\n    position: absolute;\n    top: 0; left: 0; right: 0; bottom: 0;\n    pointer-events: none;\n    z-index: 1;\n    background: ${gradientCss}; mix-blend-mode: ${blendMode};\n}`;
            
            navigator.clipboard.writeText(fullCss).then(() => {
                alert('CSS copied to clipboard!');
            });
        }
    </script>
</body>
</html>
